import{V as g,e as h,g as w,f as y,i as u,t as k,_,r as n}from"./rOui5HAy.js";const b={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},S={class:"block sm:inline"},A=g({__name:"AppAlert",props:{message:{}},emits:["close"],setup(a){return(t,e)=>t.message?(y(),h("div",b,[u("span",S,k(t.message),1),u("button",{class:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:e[0]||(e[0]=s=>t.$emit("close"))},e[1]||(e[1]=[u("span",{class:"text-2xl"},"Ã—",-1)]))])):w("",!0)}}),P=_(A,[["__scopeId","data-v-894011f4"]]),l=n(!1),r=n(null),d=n(!1),f=n(!1),p=n(!1),c=n(null),o=n(null),i="http://localhost:8000/auth";if(typeof window<"u"){const a=localStorage.getItem("access_token");if(a){c.value=a,l.value=!0;try{const t=JSON.parse(atob(a.split(".")[1]));t&&t.sub&&(r.value={email:t.sub})}catch{r.value=null}}}async function v(a,t){o.value=null;try{const e=await fetch(`${i}/login`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:a,password:t})});if(!e.ok){const m=await e.json().catch(()=>({}));throw new Error(m.detail||"Login failed")}const s=await e.json();c.value=s.access_token,localStorage.setItem("access_token",s.access_token),l.value=!0,r.value={email:a},d.value=!1}catch(e){e instanceof Error?o.value=e.message||"Reset failed":o.value="An unknown error occurred",l.value=!1,r.value=null,c.value=null,localStorage.removeItem("access_token"),o.value=e instanceof Error?e.message||"Login failed":"An unknown error occurred"}}async function R(a,t){o.value=null;try{const e=await fetch(`${i}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||"Registration failed")}await v(a,t),f.value=!1}catch(e){e instanceof Error?o.value=e.message||"Registration failed":o.value="An unknown error occurred"}}async function E(){o.value=null;try{await fetch(`${i}/logout`,{method:"POST"})}catch{}l.value=!1,r.value=null,c.value=null,localStorage.removeItem("access_token")}async function T(a,t="newpassword"){o.value=null;try{const e=await fetch(`${i}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||"Reset failed")}p.value=!1}catch(e){e instanceof Error?o.value=e.message||"Reset failed":o.value="An unknown error occurred"}}function j(){return{isAuthenticated:l,user:r,showLogin:d,showRegister:f,showReset:p,login:v,register:R,logout:E,resetPassword:T,token:c,errorMessage:o}}export{P as A,j as u};
