import{P as g,r as n,b as h,e as w,g as y,f as k,i as u,t as _,_ as b}from"./c5Wa8bw9.js";const S={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4",role:"alert"},A={class:"block sm:inline"},R=g({__name:"AppAlert",props:{message:{}},emits:["close"],setup(a){const t=n(!1);return h(()=>{t.value=!0}),(e,s)=>e.message&&t.value?(k(),w("div",S,[u("span",A,_(e.message),1),u("button",{class:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:s[0]||(s[0]=d=>e.$emit("close"))},s[1]||(s[1]=[u("span",{class:"text-2xl"},"Ã—",-1)]))])):y("",!0)}}),j=b(R,[["__scopeId","data-v-c8ebfe87"]]),l=n(!1),r=n(null),f=n(!1),p=n(!1),v=n(!1),c=n(null),o=n(null),i="http://localhost:8000/auth";if(typeof window<"u"){const a=localStorage.getItem("access_token");if(a){c.value=a,l.value=!0;try{const t=JSON.parse(atob(a.split(".")[1]));t&&t.sub&&(r.value={email:t.sub})}catch{r.value=null}}}async function m(a,t){o.value=null;try{const e=await fetch(`${i}/login`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({username:a,password:t})});if(!e.ok){const d=await e.json().catch(()=>({}));throw new Error(d.detail||"Login failed")}const s=await e.json();c.value=s.access_token,localStorage.setItem("access_token",s.access_token),l.value=!0,r.value={email:a},f.value=!1}catch(e){e instanceof Error?o.value=e.message||"Reset failed":o.value="An unknown error occurred",l.value=!1,r.value=null,c.value=null,localStorage.removeItem("access_token"),o.value=e instanceof Error?e.message||"Login failed":"An unknown error occurred"}}async function E(a,t){o.value=null;try{const e=await fetch(`${i}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||"Registration failed")}await m(a,t),p.value=!1}catch(e){e instanceof Error?o.value=e.message||"Registration failed":o.value="An unknown error occurred"}}async function P(){o.value=null;try{await fetch(`${i}/logout`,{method:"POST"})}catch{}l.value=!1,r.value=null,c.value=null,localStorage.removeItem("access_token")}async function T(a,t="newpassword"){o.value=null;try{const e=await fetch(`${i}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:t})});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.detail||"Reset failed")}v.value=!1}catch(e){e instanceof Error?o.value=e.message||"Reset failed":o.value="An unknown error occurred"}}function x(){return{isAuthenticated:l,user:r,showLogin:f,showRegister:p,showReset:v,login:m,register:E,logout:P,resetPassword:T,token:c,errorMessage:o}}export{j as A,x as u};
